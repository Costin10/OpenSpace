#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd -- "${SCRIPT_DIR}/.." && pwd)"
TARGET_PATH="${1:-.}"

RELEASE_BIN="${REPO_ROOT}/src-tauri/target/release/openspace"

if [[ -x "${RELEASE_BIN}" ]]; then
  exec "${RELEASE_BIN}" "${TARGET_PATH}"
fi

if command -v cargo >/dev/null 2>&1; then
  exec cargo run --manifest-path "${REPO_ROOT}/src-tauri/Cargo.toml" -- "${TARGET_PATH}"
fi

echo "OpenSpace launcher could not find a release binary and cargo is not installed." >&2
exit 1
