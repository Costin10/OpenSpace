import{r as o,j as e}from"./vendor-codemirror-YmvNK9KJ.js";import{a as r,X as Q,S as B}from"./index-BjdFrzXK.js";import{u as V,b as Z,E as ee}from"./useApi-BCHzo7MO.js";import{B as D,L as te,P as I,C as se,b as re,a as ae}from"./MainApp-CsQxt9Iy.js";import{C as ne}from"./circle-alert-DGt2vr4w.js";import{L as oe,F as Y,C as ie}from"./CreateProjectModal-DZE9Qx9e.js";import{R as M}from"./refresh-cw-Du5FK0wQ.js";import{C as le}from"./chevron-left-BRK2ZYh3.js";import{T as ce}from"./trash-2-B4sySCZE.js";import"./vendor-markdown-Bqz58gXN.js";import"./vendor-react-bmmOCWbf.js";const U=`You are a helpful AI assistant. You are knowledgeable, friendly, and always aim to provide accurate and useful information.

Key behaviors:
- Be concise but thorough in your responses
- Ask clarifying questions when needed
- Acknowledge limitations when appropriate
- Provide examples when they help clarify concepts`,de=[{name:"General Assistant",prompt:U},{name:"Code Reviewer",prompt:`You are an expert code reviewer. Your role is to:
- Analyze code for bugs, security vulnerabilities, and performance issues
- Suggest improvements and best practices
- Explain your reasoning clearly
- Be constructive and educational in your feedback
- Focus on the most impactful changes first`},{name:"Technical Writer",prompt:`You are a skilled technical writer who specializes in creating clear, concise documentation. Your approach:
- Use simple language to explain complex concepts
- Structure content logically with clear headings
- Include examples and code snippets where helpful
- Anticipate reader questions and address them proactively
- Follow documentation best practices`},{name:"Project Manager",prompt:`You are an experienced project manager assistant. You help with:
- Breaking down tasks and creating actionable plans
- Identifying risks and dependencies
- Estimating timelines and resources
- Tracking progress and blockers
- Facilitating team communication and alignment`}];function me({agent:s,isOpen:x,onClose:C,onCreate:k,onUpdate:n}){const[m,l]=o.useState(""),[i,j]=o.useState(""),[S,u]=o.useState(null),[p,y]=o.useState(!1),[A,f]=o.useState(!1),g=o.useRef(null),h=!!s;o.useEffect(()=>{s?(l(s.name),j(s.systemPrompt)):(l(""),j(U)),u(null)},[s]),o.useEffect(()=>{x&&g.current&&setTimeout(()=>g.current?.focus(),100)},[x]);const L=async c=>{c.preventDefault(),u(null);const b=m.trim(),N=i.trim();if(!b){u("Agent name is required");return}if(b.length>255){u("Agent name must be 255 characters or less");return}if(!N){u("System prompt is required");return}if(N.length>1e5){u("System prompt must be 100,000 characters or less");return}y(!0);try{let P;h?P=await n(s.id,{name:b,systemPrompt:N}):P=await k(b,N),P.success||u("Failed to save agent. Please try again.")}catch{u("An unexpected error occurred")}finally{y(!1)}},v=c=>{j(c.prompt),f(!1)},w=()=>{p||C()};return x?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:w}),e.jsxs("div",{className:r("relative bg-surface border border-border rounded-lg","w-full max-w-xl max-h-[85vh] mx-4","flex flex-col shadow-2xl","animate-in fade-in-0 zoom-in-95"),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:r("flex items-center justify-center w-8 h-8 rounded-md","bg-accent-blue/10 border border-accent-blue/20"),children:e.jsx(D,{size:16,className:"text-accent-blue"})}),e.jsx("h2",{className:"text-base font-semibold text-text-primary",children:h?"Edit Agent":"Create Agent"})]}),e.jsx("button",{onClick:w,disabled:p,className:r("p-1.5 rounded-md text-text-muted","hover:text-text-primary hover:bg-surface-hover","transition-colors disabled:opacity-50"),children:e.jsx(Q,{size:18})})]}),e.jsxs("form",{onSubmit:L,className:"flex-1 overflow-auto",children:[e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[S&&e.jsxs("div",{className:r("flex items-center gap-2 px-3 py-2 rounded-md","bg-accent-red/10 border border-accent-red/20","text-xs text-accent-red"),children:[e.jsx(ne,{size:14}),S]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"agent-name",className:"block text-xs font-medium text-text-secondary mb-1",children:"Name"}),e.jsx("input",{ref:g,id:"agent-name",type:"text",value:m,onChange:c=>l(c.target.value),placeholder:"e.g., Code Review Bot",disabled:p,className:r("w-full px-3 py-2 rounded-md text-sm","bg-background border border-border","text-text-primary placeholder:text-text-muted/60","focus:outline-none focus:ring-1 focus:ring-accent-blue/50 focus:border-accent-blue/50","disabled:opacity-50 disabled:cursor-not-allowed","transition-colors")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("label",{htmlFor:"system-prompt",className:"flex items-center gap-1.5 text-xs font-medium text-text-secondary",children:[e.jsx(B,{size:12,className:"text-accent-cyan"}),"System Prompt"]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>f(!A),className:r("text-xs text-accent-blue/80 hover:text-accent-blue","transition-colors"),children:"Templates"}),A&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>f(!1)}),e.jsx("div",{className:r("absolute right-0 top-full mt-1 z-50","bg-surface border border-border rounded-md shadow-lg","py-0.5 min-w-[160px]","animate-in fade-in-0 zoom-in-95"),children:de.map(c=>e.jsx("button",{type:"button",onClick:()=>v(c),className:r("block w-full px-3 py-1.5 text-left text-xs","text-text-secondary hover:text-text-primary","hover:bg-surface-hover transition-colors"),children:c.name},c.name))})]})]})]}),e.jsx("textarea",{id:"system-prompt",value:i,onChange:c=>j(c.target.value),placeholder:"Define your agent's behavior...",disabled:p,rows:8,className:r("w-full px-3 py-2 rounded-md text-xs font-mono leading-relaxed","bg-background border border-border","text-text-primary placeholder:text-text-muted/60","focus:outline-none focus:ring-1 focus:ring-accent-blue/50 focus:border-accent-blue/50","disabled:opacity-50 disabled:cursor-not-allowed","transition-colors resize-none scrollbar-thin")}),e.jsx("div",{className:"flex items-center justify-end mt-1",children:e.jsxs("span",{className:r("text-[10px] tabular-nums",i.length>9e4?"text-accent-red":"text-text-muted/60"),children:[i.length.toLocaleString()," / 100k"]})})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 px-4 py-3 border-t border-border",children:[e.jsx("button",{type:"button",onClick:w,disabled:p,className:r("px-3 py-1.5 rounded-md text-xs font-medium","text-text-muted hover:text-text-primary","hover:bg-surface-hover transition-colors","disabled:opacity-50 disabled:cursor-not-allowed"),children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:p||!m.trim()||!i.trim(),className:r("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium","bg-accent-blue text-white","hover:bg-accent-blue/90 transition-colors","disabled:opacity-50 disabled:cursor-not-allowed"),children:[p&&e.jsx(te,{size:12,className:"animate-spin"}),h?"Save":"Create"]})]})]})]})]}):null}const E="agents-selected-project";function xe(s,x=120){return s.length<=x?s:s.slice(0,x).trim()+"..."}function O(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function ue({agent:s,onClick:x,onEdit:C,onDelete:k,onDuplicate:n}){const[m,l]=o.useState(!1);return e.jsxs("div",{className:r("group relative bg-surface rounded-lg border border-border","hover:border-border-active hover:shadow-lg hover:shadow-accent-blue/5","transition-all duration-200 cursor-pointer"),onClick:x,children:[e.jsxs("div",{className:"flex items-start justify-between p-4 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:r("flex items-center justify-center w-10 h-10 rounded-lg","bg-gradient-to-br from-accent-blue/20 to-accent-cyan/20","border border-accent-blue/30"),children:e.jsx(D,{size:20,className:"text-accent-blue"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary truncate",children:s.name}),e.jsxs("p",{className:"text-[11px] text-text-muted mt-0.5",children:["Created ",O(s.createdAt)]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),l(!m)},className:r("p-1.5 rounded-md opacity-0 group-hover:opacity-100","text-text-muted hover:text-text-primary hover:bg-surface-hover","transition-all duration-150",m&&"opacity-100 bg-surface-hover"),children:e.jsx(ee,{size:16})}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:i=>{i.stopPropagation(),l(!1)}}),e.jsxs("div",{className:r("absolute right-0 top-full mt-1 z-50","bg-surface border border-border rounded-lg shadow-xl","py-1 min-w-[140px]","animate-in fade-in-0 zoom-in-95"),children:[e.jsxs("button",{onClick:i=>{i.stopPropagation(),l(!1),C()},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-text-secondary hover:text-text-primary hover:bg-surface-hover",children:[e.jsx(re,{size:14}),"Edit"]}),e.jsxs("button",{onClick:i=>{i.stopPropagation(),l(!1),n()},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-text-secondary hover:text-text-primary hover:bg-surface-hover",children:[e.jsx(ae,{size:14}),"Duplicate"]}),e.jsx("div",{className:"h-px bg-border my-1"}),e.jsxs("button",{onClick:i=>{i.stopPropagation(),l(!1),k()},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-accent-red hover:bg-accent-red/10",children:[e.jsx(ce,{size:14}),"Delete"]})]})]})]})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:r("text-xs text-text-muted leading-relaxed","bg-background/50 rounded-md p-3 mt-2","border border-border/50"),children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5 text-accent-cyan",children:[e.jsx(B,{size:12}),e.jsx("span",{className:"text-[10px] font-medium uppercase tracking-wide",children:"System Prompt"})]}),e.jsx("p",{className:"line-clamp-3",children:xe(s.systemPrompt,150)})]})}),e.jsxs("div",{className:"px-4 pb-3 flex items-center justify-between text-[10px] text-text-muted",children:[e.jsxs("span",{children:["Updated ",O(s.updatedAt)]}),e.jsx("span",{className:"font-mono bg-surface-hover px-1.5 py-0.5 rounded",children:s.id.slice(0,8)})]})]})}function pe({onCreateAgent:s}){return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-16",children:[e.jsx("div",{className:r("flex items-center justify-center w-20 h-20 rounded-2xl mb-6","bg-gradient-to-br from-accent-blue/10 to-accent-cyan/10","border border-accent-blue/20"),children:e.jsx(D,{size:40,className:"text-accent-blue/60"})}),e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"No agents yet"}),e.jsx("p",{className:"text-sm text-text-muted text-center max-w-md mb-6",children:"Create your first AI agent to define custom behaviors and system prompts for your project."}),e.jsxs("button",{onClick:s,className:r("flex items-center gap-2 px-4 py-2.5 rounded-lg","bg-accent-blue text-white font-medium text-sm","hover:bg-accent-blue/90 transition-colors"),children:[e.jsx(I,{size:18}),"Create Agent"]})]})}function Se(){const{projects:s,loading:x,error:C,createProject:k}=V(),[n,m]=o.useState(()=>{try{return localStorage.getItem(E)}catch{return null}}),{agents:l,loading:i,error:j,createAgent:S,updateAgent:u,deleteAgent:p,refresh:y}=Z(n,{enabled:!!n}),[A,f]=o.useState(!1),[g,h]=o.useState(null),[L,v]=o.useState(!1),[w,c]=o.useState(null);o.useEffect(()=>{const t=()=>{const a=localStorage.getItem(E);a&&(m(a),setTimeout(()=>y(),100))};return window.addEventListener("bridgemind:project-changed",t),()=>window.removeEventListener("bridgemind:project-changed",t)},[y]),o.useEffect(()=>{n?localStorage.setItem(E,n):localStorage.removeItem(E)},[n]),o.useEffect(()=>{!n&&s.length>0&&m(s[0].id)},[s,n]),o.useEffect(()=>{n&&s.length>0&&(s.some(a=>a.id===n)||m(s[0].id))},[s,n]);const b=o.useRef(null),[N,P]=o.useState(!1),[W,_]=o.useState(!1),z=()=>{const t=b.current;if(t){const a=t.scrollWidth>t.clientWidth,d=t.scrollLeft>0,H=t.scrollLeft+t.clientWidth>=t.scrollWidth-1;P(a&&d),_(a&&!H)}};o.useEffect(()=>(z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)),[s]);const F=t=>{const a=b.current;a&&(a.scrollBy({left:t==="left"?-200:200,behavior:"smooth"}),setTimeout(z,300))},q=async(t,a)=>{const d=await S(t,a);return d.success&&v(!1),d},K=async(t,a)=>{const d=await u(t,a);return d.success&&h(null),d},G=async t=>{const a=await p(t);return a.success&&c(null),a},J=async t=>{await S(`${t.name} (Copy)`,t.systemPrompt)},X=async(t,a)=>{const d=await k(t,a);return d.success&&d.data&&(m(d.data.id),f(!1)),d},$=async()=>{if(n)try{const t=await window.tauriAPI?.dialog?.openFolder({title:"Select Folder to Link"});if(t){const a=JSON.stringify({projectId:n},null,2),d=await window.tauriAPI.fs.join(t,".bridgemind.json");await window.tauriAPI.fs.writeFile(d,a),localStorage.setItem(E,n),window.dispatchEvent(new CustomEvent("bridgemind:project-changed",{detail:{projectId:n,path:t}})),alert("Folder linked successfully!")}}catch{}},T=x||i,R=C||j;return e.jsxs("div",{className:"flex flex-col h-full bg-background",children:[e.jsxs("div",{className:"border-b border-border bg-surface/50",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-sm font-semibold text-text-primary",children:"Agents"}),e.jsxs("span",{className:"text-[11px] text-text-muted bg-surface-hover px-2 py-0.5 rounded-full",children:[l.length," ",l.length===1?"agent":"agents"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(),className:r("p-2 rounded-md text-text-muted hover:text-text-primary","hover:bg-surface-hover transition-colors",T&&"animate-spin"),title:"Refresh agents",children:e.jsx(M,{size:14})}),e.jsxs("button",{onClick:()=>f(!0),className:r("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium","border border-border text-text-primary","hover:bg-surface-hover transition-colors"),children:[e.jsx(I,{size:14}),e.jsx("span",{children:"New Project"})]}),e.jsxs("button",{onClick:$,className:r("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium","border border-border text-text-primary","hover:bg-surface-hover transition-colors",!n&&"opacity-60 cursor-not-allowed"),disabled:!n,title:"Link current project to a folder",children:[e.jsx(oe,{size:14}),e.jsx("span",{children:"Link Folder"})]}),e.jsxs("button",{onClick:()=>v(!0),disabled:!n||T,className:r("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium","bg-accent-blue text-white","hover:bg-accent-blue/90 transition-colors",!n&&"opacity-60 cursor-not-allowed"),children:[e.jsx(I,{size:14}),e.jsx("span",{children:"New Agent"})]})]})]}),e.jsxs("div",{className:"relative flex items-center px-4 pb-0",children:[N&&e.jsx("button",{onClick:()=>F("left"),className:"absolute left-1 z-10 p-1 rounded-md bg-surface/90 border border-border text-text-muted hover:text-text-primary hover:bg-surface-hover transition-colors",children:e.jsx(le,{size:14})}),e.jsxs("div",{ref:b,onScroll:z,className:"flex items-end gap-1 overflow-x-auto scrollbar-none",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[s.map(t=>{const a=t.id===n;return e.jsxs("button",{onClick:()=>m(t.id),className:r("group flex items-center gap-2 px-4 py-2 text-xs font-medium whitespace-nowrap rounded-t-lg transition-all","border-x border-t",a?"bg-background text-text-primary border-border -mb-px":"bg-transparent text-text-muted hover:text-text-secondary border-transparent hover:bg-surface-hover/50"),children:[e.jsx(Y,{size:14,className:r(a?"text-accent-cyan":"text-text-muted group-hover:text-text-secondary")}),e.jsx("span",{className:"max-w-[150px] truncate",children:t.name}),a&&e.jsx("span",{className:"text-[10px] text-text-muted bg-surface-hover px-1.5 py-0.5 rounded",children:l.length})]},t.id)}),s.length===0&&!x&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-xs text-text-muted",children:[e.jsx(Y,{size:14}),e.jsx("span",{children:"No projects yet"})]})]}),W&&e.jsx("button",{onClick:()=>F("right"),className:"absolute right-1 z-10 p-1 rounded-md bg-surface/90 border border-border text-text-muted hover:text-text-primary hover:bg-surface-hover transition-colors",children:e.jsx(se,{size:14})})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto scrollbar-thin p-4",children:[R&&e.jsx("div",{className:"mb-4 p-3 bg-accent-red/10 border border-accent-red/30 rounded-lg text-sm text-accent-red",children:R}),T&&l.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{size:24,className:"text-text-muted animate-spin"})}):l.length===0?e.jsx(pe,{onCreateAgent:()=>v(!0)}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:l.map(t=>e.jsx(ue,{agent:t,onClick:()=>h(t),onEdit:()=>h(t),onDelete:()=>c(t.id),onDuplicate:()=>J(t)},t.id))})]}),(L||g)&&e.jsx(me,{agent:g,isOpen:L||!!g,onClose:()=>{v(!1),h(null)},onCreate:q,onUpdate:K}),A&&e.jsx(ie,{isOpen:A,onClose:()=>f(!1),onSubmit:X}),w&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>c(null)}),e.jsxs("div",{className:"relative bg-surface border border-border rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Delete Agent"}),e.jsx("p",{className:"text-sm text-text-muted mb-6",children:"Are you sure you want to delete this agent? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>c(null),className:r("px-4 py-2 rounded-lg text-sm font-medium","text-text-secondary hover:text-text-primary","hover:bg-surface-hover transition-colors"),children:"Cancel"}),e.jsx("button",{onClick:()=>G(w),className:r("px-4 py-2 rounded-lg text-sm font-medium","bg-accent-red text-white","hover:bg-accent-red/90 transition-colors"),children:"Delete"})]})]})]})]})}export{Se as AgentsPage};
